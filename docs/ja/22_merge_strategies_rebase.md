## マージの活用：リベース

このセクションでは、もう一つの一般的なマージの活用について説明します。

### Gitマージの活用方法

Gitには3つの主なマージの活用方法があります。

#### Fast forward

fast forwardのマージは、フィーチャブランチが作成された後に、ベースブランチに変更がないことが前提です。 つまり、ベースブランチのポインタを、単にフィーチャブランチが指しているコミットと同じコミットを指すよう、「fast forward」（早送り）することができます。

#### 再帰的

再帰的マージは、ベースブランチとフィーチャブランチの両方が変更されており、gitが両方を再帰的に結合する必要があるということを意味します。 再帰的なマージでは、2つのブランチが結合された時点に印をつけるため、新しい「マージコミット」が作成されます。 このマージコミットには、複数の親が存在するため特殊です。

#### タコ足

3つ以上のブランチのマージはタコ足マージと言います。 このマージにより、複数の親が存在するマージコミットも作成されます。

### Gitリベースについて

`git rebase` を使うことで、コミット履歴をさまざまな方法で変更できます。 例えば、コミットを並び替えや編集、複数のコミットを1つにsquashすることなど、多数の方法があります。

上記の機能を有効とするために、`rebase` にはいくつかの形式が存在します。 今回のクラスでは、インタラクティブリベースを使います。`git rebase --interactive` または `git rebase -i` （ショートカット）

通常、`git rebase -i`は以下のように使用します。

- あるブランチを他のブランチでリプレーする
- 以前のコミットメッセージの編集
- 複数のコミットを1つにまとめる
- 不要になったコミットの打ち消しまたは、削除

### 直線的な履歴の作成方法

リベースの最も一般的な用途の1つは、再帰的なマージをなくし、より直線的な履歴を作成することです。 この課題では、そのやり方を学習します。

![Gitリベース](../img/git-rebase.png)

#### 準備

1. 最初のコミットのSHAを見つけます。`git log --oneline`
2. 最初のコミットのSHAにリセットします。`git reset --hard SHA`
3. 新しいブランチを作成し、そのブランチにチェックアウトします。`git switch -c rebase-me`
4. reflogを使用し、ファイル4-6を `rebase-me` のブランチにチェリーピックします。
5. masterにチェックアウトします。`git switch master`
6. reflogを使用し、ファイル1-3を `master` のブランチにチェリーピックします。
7. 履歴を確認します。`git log --oneline --graph --decorate --all`
8. この時点で仮にマージすると、再帰的なマージとなります。

#### リベースを開始

1. `rebase-me` のブランチにチェックアウトします。`git switch rebase-me`
2. マージを開始します。`git rebase -i master`
3. テキストエディタが開き、リベースされるコミットが表示されます。
4. `rebase-todo` を保存し、閉じます。
5. リベースがコマンドラインで実行されます。
6. 再度、履歴を確認します。`git log --oneline --graph --decorate --all`
7. この時点で仮にマージすると、fast-forwardマージとなります。

#### マージの完了

1. マージするmasterのブランチにチェックアウトします。`git switch master`
2. 変更をmasterにマージします。`git merge rebase-me`
