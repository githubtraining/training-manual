## コードでのイベント検索方法

このセクションでは、リポジトリにバグが入ってしまったコミットを `git bisect` で検索する方法を学習しましょう。

### `git bisect` とは？

`git bisect` はバイナリー検索を使うことで、コードでの具体的なイベントを検出できます。 例えば、bisectを使って、以下のようなイベントがあったコミットを探し出すことができます。

- バグが入ってしまった
- 新しい機能が追加された
- ベンチマークのパフォーマンスが向上した

#### Bisectの仕組み

`git bisect` は、２点間にある履歴を半分にし、そのコミットをチェックアウトします。 ユーザは、その時点でのバグや機能の有無を確認し、Gitにその結果を伝えます。 その後Gitは、探しているコミットが見つかるまで同じ過程を繰り返します。

![Git Bisect](../img/git-bisect.png)

> Bisectが行われているときは、本質的に切り離されたHEAD (detached HEAD) の状態になっています。 Git で他の操作を行う前に、`git bisect reset` を実行して bisect を終了しましょう。 {: .warning}

### プロジェクトでのバグの探し方

#### 詳細方法

1. バイナリ検索を始めます。`git bisect start`
2. コードが壊れているコミットを指定します。 `git bisect bad <SHA>`
3. コードがちゃんと機能していたコミットを指定します。`git bisect good <SHA>`
4. Bisectはその中間のコミットをチェックアウトします。
5. テストを実行し、ゲームが機能しているかどうかを確認します。 実行するテストは、`ls` を使って、`index.html` の有無を確認します。
6. ゲームがまだ壊れていたら（ `index.html` というファイルが存在*していなかったら*）、 `git bisect bad` と入力します。
7. ゲームが機能していたら（そして、`index.html` というファイルが存在*していたら*）、 `git bisect good` と入力します。
8. Gitは、改めてbisectを行い、テストの実行を待ちます。 この過程は、Gitが最初に問題が発生したコミットを突き止めるのに十分な情報を集めるまで続きます。
9. Gitがエラーを検出すると、`SHA is the first bad commit.` というメッセージが表示されます。
10. Bisectのプロセスを終了します。`git bisect reset`

#### ショートカットを使用する方法

Bisectは、コードに対し自動的にテストを実行することもできます。 ショートカットのコマンドとテストを使って、もう一度やってみましょう。

1. `git bisect start <bad-SHA> <good-SHA>`
1. `git bisect run ls index.html`
1. `git bisect reset`
